#!/usr/bin/env ruby

require 'pp'
require 'pathname'

root_path = Pathname.new("__FILE__}/..").expand_path

require root_path.join('lib/smith')
require root_path.join('lib/smith/application/agency')

module Smith
  class AgencyRunner

    include Logger

    def initialize(root)
      @agency = Agency.new(:path => Smith.agent_default_path)
    end

    def run
      Smith.start do
        logger.info("Starting #{File.basename($0)}")
        @agency.setup_queues
        @agency.start_monitoring
      end
    end
  end
end

%w{TERM INT QUIT}.each do |sig|
  trap sig, proc { puts "Shutting down"; Smith.stop }
end

agency_runner = Smith::AgencyRunner.new(root_path)
agency_runner.run
