#!/usr/bin/env ruby

require 'pp'
require 'amqp'
require "amqp/extensions/rabbitmq"


EM.run do
  AMQP.connect do |connection|
    channel = AMQP::Channel.new(connection)
    exchange = channel.topic("smith.exchange", :durable => true)

    exchange.publish('hello', :nowait => false, :routing_key => "smith.agency.controller.#{ARGV[0]}") do
      connection.close { EventMachine.stop }
    end
  end
end
